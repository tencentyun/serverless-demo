import { CreateCopilotRuntimeServerOptions } from '@copilotkit/runtime';
import { CopilotRuntimeOptions } from '@copilotkit/runtime/v2';
import express, { Express } from 'express';
import * as _ag_ui_client from '@ag-ui/client';
import { AbstractAgent, RunAgentInput } from '@ag-ui/client';
import cors from 'cors';
import { SendMessageInput } from '@cloudbase/agent-shared';
import { Repeater } from '@repeaterjs/repeater';
import * as _whatwg_node_server from '@whatwg-node/server';
import { OpenAI } from 'openai';

type AgentCreatorRet = {
    agent: AbstractAgent | {
        toAGUIAgent(): AbstractAgent;
    };
    cleanup?: () => void;
};
type AgentCreator = () => AgentCreatorRet | Promise<AgentCreatorRet>;
interface ICreateServer {
    createAgent: AgentCreator;
    basePath?: `/${string}/`;
    cors?: boolean | cors.CorsOptions;
    useAGUI?: boolean;
    aguiOptions?: AGUIOptions;
}
interface IRun extends ICreateServer {
    port?: number | string;
}
interface ICreateExpressRoutes extends ICreateServer {
    express: Express;
}
declare function run(props: IRun): void;
declare function createExpressServer(props: ICreateServer): Express;
declare function createExpressRoutes({ createAgent, basePath: _basePath, express, useAGUI: _useAGUI, aguiOptions, }: ICreateExpressRoutes): express.Express;
interface AGUIOptions {
    runtimeOptions?: Partial<CopilotRuntimeOptions>;
    endpointOptions?: Partial<CreateCopilotRuntimeServerOptions>;
}

declare function handler$2(input: SendMessageInput, agent: AbstractAgent): Repeater<{
    type: "text";
    content: string;
} | {
    type: "tool-call-start";
    toolCallId: string;
    toolCallName: string;
} | {
    type: "tool-call-args";
    toolCallId: string;
    delta: string;
} | {
    type: "tool-call-end";
    toolCallId: string;
} | {
    type: "tool-result";
    toolCallId: string;
    result: string;
} | {
    type: "interrupt";
    id: string;
    reason: string;
    payload: any;
}, any, unknown>;

declare function createServerAdapter$2(createAgent: AgentCreator): _whatwg_node_server.ServerAdapter<{}, _whatwg_node_server.ServerAdapterBaseObject<{}, (request: Request) => Promise<Response>>>;

declare namespace index$4 {
  export { createServerAdapter$2 as createServerAdapter, handler$2 as handler };
}

declare function handler$1(input: RunAgentInput, agent: AbstractAgent): Repeater<{
    type: _ag_ui_client.EventType;
    timestamp?: number | undefined;
    rawEvent?: any;
}, any, unknown>;

declare function createServerAdapter$1(createAgent: AgentCreator): _whatwg_node_server.ServerAdapter<{}, _whatwg_node_server.ServerAdapterBaseObject<{}, (request: Request) => Promise<Response>>>;

declare namespace index$3 {
  export { createServerAdapter$1 as createServerAdapter, handler$1 as handler };
}

declare const serverAdapter: _whatwg_node_server.ServerAdapter<{}, _whatwg_node_server.ServerAdapterBaseObject<{}, () => Response>>;

declare const index$2_serverAdapter: typeof serverAdapter;
declare namespace index$2 {
  export { index$2_serverAdapter as serverAdapter };
}

type OpenAIMessage = OpenAI.Chat.Completions.ChatCompletionMessageParam;
type OpenAITool = OpenAI.Chat.Completions.ChatCompletionTool;
type ChatCompletionsInput = {
    messages: Array<OpenAIMessage>;
    tools?: Array<OpenAITool>;
};
declare function handler(input: ChatCompletionsInput, agent: AbstractAgent): Repeater<OpenAI.Chat.Completions.ChatCompletionChunk, any, unknown>;

declare function createServerAdapter(createAgent: AgentCreator): _whatwg_node_server.ServerAdapter<{}, _whatwg_node_server.ServerAdapterBaseObject<{}, (request: Request) => Promise<Response>>>;

declare const index$1_createServerAdapter: typeof createServerAdapter;
declare const index$1_handler: typeof handler;
declare namespace index$1 {
  export { index$1_createServerAdapter as createServerAdapter, index$1_handler as handler };
}

declare namespace index {
  export { index$2 as healthz, index$1 as openai, index$4 as sendMessage, index$3 as sendMessageAGUI };
}

export { type AgentCreator, index as agui, createExpressRoutes, createExpressServer, run };
