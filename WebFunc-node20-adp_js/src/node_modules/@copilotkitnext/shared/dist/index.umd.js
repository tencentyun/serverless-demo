!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("zod")):"function"==typeof define&&define.amd?define(["exports","zod"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CopilotKitNextShared={},t.Zod)}(this,function(t,e){"use strict";const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));let n;const o=new Uint8Array(16);var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function s(t,e,s){if(i.randomUUID&&!t)return i.randomUUID();const a=(t=t||{}).random??t.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(o)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}(a)}var a,l,T={},d={};function E(){return a||(a=1,t=d,Object.defineProperty(t,"__esModule",{value:!0}),t.Allow=t.ALL=t.COLLECTION=t.ATOM=t.SPECIAL=t.INF=t._INFINITY=t.INFINITY=t.NAN=t.BOOL=t.NULL=t.OBJ=t.ARR=t.NUM=t.STR=void 0,t.STR=1,t.NUM=2,t.ARR=4,t.OBJ=8,t.NULL=16,t.BOOL=32,t.NAN=64,t.INFINITY=128,t._INFINITY=256,t.INF=t.INFINITY|t._INFINITY,t.SPECIAL=t.NULL|t.BOOL|t.INF|t.NAN,t.ATOM=t.STR|t.NUM|t.SPECIAL,t.COLLECTION=t.ARR|t.OBJ,t.ALL=t.ATOM|t.COLLECTION,t.Allow={STR:t.STR,NUM:t.NUM,ARR:t.ARR,OBJ:t.OBJ,NULL:t.NULL,BOOL:t.BOOL,NAN:t.NAN,INFINITY:t.INFINITY,_INFINITY:t._INFINITY,INF:t.INF,SPECIAL:t.SPECIAL,ATOM:t.ATOM,COLLECTION:t.COLLECTION,ALL:t.ALL},t.default=t.Allow),d;var t}var p=(l||(l=1,function(t){var e=T&&T.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=T&&T.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Allow=t.MalformedJSON=t.PartialJSON=t.parseJSON=t.parse=void 0;const n=E();Object.defineProperty(t,"Allow",{enumerable:!0,get:function(){return n.Allow}}),r(E(),t);class o extends Error{}t.PartialJSON=o;class i extends Error{}function s(t,e=n.Allow.ALL){if("string"!=typeof t)throw new TypeError("expecting str, got "+typeof t);if(!t.trim())throw new Error(`${t} is empty`);return a(t.trim(),e)}t.MalformedJSON=i,t.parseJSON=s;const a=(t,e)=>{const r=t.length;let s=0;const a=t=>{throw new o(`${t} at position ${s}`)},l=t=>{throw new i(`${t} at position ${s}`)},T=()=>(_(),s>=r&&a("Unexpected end of input"),'"'===t[s]?d():"{"===t[s]?E():"["===t[s]?p():"null"===t.substring(s,s+4)||n.Allow.NULL&e&&r-s<4&&"null".startsWith(t.substring(s))?(s+=4,null):"true"===t.substring(s,s+4)||n.Allow.BOOL&e&&r-s<4&&"true".startsWith(t.substring(s))?(s+=4,!0):"false"===t.substring(s,s+5)||n.Allow.BOOL&e&&r-s<5&&"false".startsWith(t.substring(s))?(s+=5,!1):"Infinity"===t.substring(s,s+8)||n.Allow.INFINITY&e&&r-s<8&&"Infinity".startsWith(t.substring(s))?(s+=8,1/0):"-Infinity"===t.substring(s,s+9)||n.Allow._INFINITY&e&&1<r-s&&r-s<9&&"-Infinity".startsWith(t.substring(s))?(s+=9,-1/0):"NaN"===t.substring(s,s+3)||n.Allow.NAN&e&&r-s<3&&"NaN".startsWith(t.substring(s))?(s+=3,NaN):N()),d=()=>{const o=s;let i=!1;for(s++;s<r&&('"'!==t[s]||i&&"\\"===t[s-1]);)i="\\"===t[s]&&!i,s++;if('"'==t.charAt(s))try{return JSON.parse(t.substring(o,++s-Number(i)))}catch(t){l(String(t))}else if(n.Allow.STR&e)try{return JSON.parse(t.substring(o,s-Number(i))+'"')}catch(e){return JSON.parse(t.substring(o,t.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},E=()=>{s++,_();const o={};try{for(;"}"!==t[s];){if(_(),s>=r&&n.Allow.OBJ&e)return o;const i=d();_(),s++;try{const t=T();o[i]=t}catch(t){if(n.Allow.OBJ&e)return o;throw t}_(),","===t[s]&&s++}}catch(t){if(n.Allow.OBJ&e)return o;a("Expected '}' at end of object")}return s++,o},p=()=>{s++;const r=[];try{for(;"]"!==t[s];)r.push(T()),_(),","===t[s]&&s++}catch(t){if(n.Allow.ARR&e)return r;a("Expected ']' at end of array")}return s++,r},N=()=>{if(0===s){"-"===t&&l("Not sure what '-' is");try{return JSON.parse(t)}catch(r){if(n.Allow.NUM&e)try{return JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch(t){}l(String(r))}}const o=s;for("-"===t[s]&&s++;t[s]&&-1===",]}".indexOf(t[s]);)s++;s!=r||n.Allow.NUM&e||a("Unterminated number literal");try{return JSON.parse(t.substring(o,s))}catch(e){"-"===t.substring(o,s)&&a("Not sure what '-' is");try{return JSON.parse(t.substring(o,t.lastIndexOf("e")))}catch(t){l(String(t))}}},_=()=>{for(;s<r&&" \n\r\t".includes(t[s]);)s++};return T()},l=s;t.parse=l}(T)),T);function N(){return s()}const _=console;var u=e.z.object({name:e.z.string(),arguments:e.z.string()}),I=e.z.object({id:e.z.string(),type:e.z.literal("function"),function:u}),c=e.z.object({id:e.z.string(),role:e.z.string(),content:e.z.string().optional(),name:e.z.string().optional()}),A=e.z.object({type:e.z.literal("text"),text:e.z.string()}),S=e.z.object({type:e.z.literal("binary"),mimeType:e.z.string(),id:e.z.string().optional(),url:e.z.string().optional(),data:e.z.string().optional(),filename:e.z.string().optional()}),g=(t,r)=>{t.id||t.url||t.data||r.addIssue({code:e.z.ZodIssueCode.custom,message:"BinaryInputContent requires at least one of id, url, or data.",path:["id"]})};S.superRefine((t,e)=>{g(t,e)});var O=e.z.discriminatedUnion("type",[A,S]).superRefine((t,e)=>{"binary"===t.type&&g(t,e)}),z=c.extend({role:e.z.literal("developer"),content:e.z.string()}),y=c.extend({role:e.z.literal("system"),content:e.z.string()}),L=c.extend({role:e.z.literal("assistant"),content:e.z.string().optional(),toolCalls:e.z.array(I).optional()}),R=c.extend({role:e.z.literal("user"),content:e.z.union([e.z.string(),e.z.array(O)])}),f=e.z.object({id:e.z.string(),content:e.z.string(),role:e.z.literal("tool"),toolCallId:e.z.string(),error:e.z.string().optional()}),m=e.z.object({id:e.z.string(),role:e.z.literal("activity"),activityType:e.z.string(),content:e.z.record(e.z.any())}),C=e.z.discriminatedUnion("role",[z,y,L,R,f,m]);e.z.union([e.z.literal("developer"),e.z.literal("system"),e.z.literal("assistant"),e.z.literal("user"),e.z.literal("tool"),e.z.literal("activity")]);var b=e.z.object({description:e.z.string(),value:e.z.string()}),U=e.z.object({name:e.z.string(),description:e.z.string(),parameters:e.z.any()}),h=e.z.object({threadId:e.z.string(),runId:e.z.string(),parentRunId:e.z.string().optional(),state:e.z.any(),messages:e.z.array(C),tools:e.z.array(U),context:e.z.array(b),forwardedProps:e.z.any()}),D=e.z.any(),M=e.z.union([e.z.literal("developer"),e.z.literal("system"),e.z.literal("assistant"),e.z.literal("user")]),w=(t=>(t.TEXT_MESSAGE_START="TEXT_MESSAGE_START",t.TEXT_MESSAGE_CONTENT="TEXT_MESSAGE_CONTENT",t.TEXT_MESSAGE_END="TEXT_MESSAGE_END",t.TEXT_MESSAGE_CHUNK="TEXT_MESSAGE_CHUNK",t.THINKING_TEXT_MESSAGE_START="THINKING_TEXT_MESSAGE_START",t.THINKING_TEXT_MESSAGE_CONTENT="THINKING_TEXT_MESSAGE_CONTENT",t.THINKING_TEXT_MESSAGE_END="THINKING_TEXT_MESSAGE_END",t.TOOL_CALL_START="TOOL_CALL_START",t.TOOL_CALL_ARGS="TOOL_CALL_ARGS",t.TOOL_CALL_END="TOOL_CALL_END",t.TOOL_CALL_CHUNK="TOOL_CALL_CHUNK",t.TOOL_CALL_RESULT="TOOL_CALL_RESULT",t.THINKING_START="THINKING_START",t.THINKING_END="THINKING_END",t.STATE_SNAPSHOT="STATE_SNAPSHOT",t.STATE_DELTA="STATE_DELTA",t.MESSAGES_SNAPSHOT="MESSAGES_SNAPSHOT",t.ACTIVITY_SNAPSHOT="ACTIVITY_SNAPSHOT",t.ACTIVITY_DELTA="ACTIVITY_DELTA",t.RAW="RAW",t.CUSTOM="CUSTOM",t.RUN_STARTED="RUN_STARTED",t.RUN_FINISHED="RUN_FINISHED",t.RUN_ERROR="RUN_ERROR",t.STEP_STARTED="STEP_STARTED",t.STEP_FINISHED="STEP_FINISHED",t))(w||{}),G=e.z.object({type:e.z.nativeEnum(w),timestamp:e.z.number().optional(),rawEvent:e.z.any().optional()}),x=G.extend({type:e.z.literal("TEXT_MESSAGE_START"),messageId:e.z.string(),role:M.default("assistant")}),v=G.extend({type:e.z.literal("TEXT_MESSAGE_CONTENT"),messageId:e.z.string(),delta:e.z.string().refine(t=>t.length>0,"Delta must not be an empty string")}),H=G.extend({type:e.z.literal("TEXT_MESSAGE_END"),messageId:e.z.string()}),F=G.extend({type:e.z.literal("TEXT_MESSAGE_CHUNK"),messageId:e.z.string().optional(),role:M.optional(),delta:e.z.string().optional()}),P=G.extend({type:e.z.literal("THINKING_TEXT_MESSAGE_START")}),K=v.omit({messageId:!0,type:!0}).extend({type:e.z.literal("THINKING_TEXT_MESSAGE_CONTENT")}),X=G.extend({type:e.z.literal("THINKING_TEXT_MESSAGE_END")}),J=G.extend({type:e.z.literal("TOOL_CALL_START"),toolCallId:e.z.string(),toolCallName:e.z.string(),parentMessageId:e.z.string().optional()}),j=G.extend({type:e.z.literal("TOOL_CALL_ARGS"),toolCallId:e.z.string(),delta:e.z.string()}),Y=G.extend({type:e.z.literal("TOOL_CALL_END"),toolCallId:e.z.string()}),B=G.extend({messageId:e.z.string(),type:e.z.literal("TOOL_CALL_RESULT"),toolCallId:e.z.string(),content:e.z.string(),role:e.z.literal("tool").optional()}),V=G.extend({type:e.z.literal("TOOL_CALL_CHUNK"),toolCallId:e.z.string().optional(),toolCallName:e.z.string().optional(),parentMessageId:e.z.string().optional(),delta:e.z.string().optional()}),W=G.extend({type:e.z.literal("THINKING_START"),title:e.z.string().optional()}),k=G.extend({type:e.z.literal("THINKING_END")}),$=G.extend({type:e.z.literal("STATE_SNAPSHOT"),snapshot:D}),q=G.extend({type:e.z.literal("STATE_DELTA"),delta:e.z.array(e.z.any())}),Q=G.extend({type:e.z.literal("MESSAGES_SNAPSHOT"),messages:e.z.array(C)}),Z=G.extend({type:e.z.literal("ACTIVITY_SNAPSHOT"),messageId:e.z.string(),activityType:e.z.string(),content:e.z.record(e.z.any()),replace:e.z.boolean().optional().default(!0)}),tt=G.extend({type:e.z.literal("ACTIVITY_DELTA"),messageId:e.z.string(),activityType:e.z.string(),patch:e.z.array(e.z.any())}),et=G.extend({type:e.z.literal("RAW"),event:e.z.any(),source:e.z.string().optional()}),rt=G.extend({type:e.z.literal("CUSTOM"),name:e.z.string(),value:e.z.any()}),nt=G.extend({type:e.z.literal("RUN_STARTED"),threadId:e.z.string(),runId:e.z.string(),parentRunId:e.z.string().optional(),input:h.optional()}),ot=G.extend({type:e.z.literal("RUN_FINISHED"),threadId:e.z.string(),runId:e.z.string(),result:e.z.any().optional()}),it=G.extend({type:e.z.literal("RUN_ERROR"),message:e.z.string(),code:e.z.string().optional()}),st=G.extend({type:e.z.literal("STEP_STARTED"),stepName:e.z.string()}),at=G.extend({type:e.z.literal("STEP_FINISHED"),stepName:e.z.string()});e.z.discriminatedUnion("type",[x,v,H,F,W,k,P,K,X,J,j,Y,V,B,$,q,Q,Z,tt,et,rt,nt,ot,it,st,at]);const lt="Run stopped by user";var Tt;t.TranscriptionErrorCode=void 0,(Tt=t.TranscriptionErrorCode||(t.TranscriptionErrorCode={})).SERVICE_NOT_CONFIGURED="service_not_configured",Tt.INVALID_AUDIO_FORMAT="invalid_audio_format",Tt.AUDIO_TOO_LONG="audio_too_long",Tt.AUDIO_TOO_SHORT="audio_too_short",Tt.RATE_LIMITED="rate_limited",Tt.AUTH_FAILED="auth_failed",Tt.PROVIDER_ERROR="provider_error",Tt.NETWORK_ERROR="network_error",Tt.INVALID_REQUEST="invalid_request";const dt={serviceNotConfigured:()=>({error:t.TranscriptionErrorCode.SERVICE_NOT_CONFIGURED,message:"Transcription service is not configured",retryable:!1}),invalidAudioFormat:(e,r)=>({error:t.TranscriptionErrorCode.INVALID_AUDIO_FORMAT,message:`Unsupported audio format: ${e}. Supported: ${r.join(", ")}`,retryable:!1}),invalidRequest:e=>({error:t.TranscriptionErrorCode.INVALID_REQUEST,message:e,retryable:!1}),rateLimited:()=>({error:t.TranscriptionErrorCode.RATE_LIMITED,message:"Rate limited. Please try again later.",retryable:!0}),authFailed:()=>({error:t.TranscriptionErrorCode.AUTH_FAILED,message:"Authentication failed with transcription provider",retryable:!1}),providerError:e=>({error:t.TranscriptionErrorCode.PROVIDER_ERROR,message:e,retryable:!0}),networkError:(e="Network error during transcription")=>({error:t.TranscriptionErrorCode.NETWORK_ERROR,message:e,retryable:!0}),audioTooLong:()=>({error:t.TranscriptionErrorCode.AUDIO_TOO_LONG,message:"Audio file is too long",retryable:!1}),audioTooShort:()=>({error:t.TranscriptionErrorCode.AUDIO_TOO_SHORT,message:"Audio is too short to transcribe",retryable:!1})};t.DEFAULT_AGENT_ID="default",t.TranscriptionErrors=dt,t.finalizeRunEvents=function(t,e={}){const{stopRequested:r=!1,interruptionMessage:n}=e,o=null!=n?n:lt,i=n&&n!==lt?n:"Run ended without emitting a terminal event",s=[],a=new Set,l=new Map;for(const e of t)switch(e.type){case w.TEXT_MESSAGE_START:{const t=e.messageId;"string"==typeof t&&a.add(t);break}case w.TEXT_MESSAGE_END:{const t=e.messageId;"string"==typeof t&&a.delete(t);break}case w.TOOL_CALL_START:{const t=e.toolCallId;"string"==typeof t&&l.set(t,{hasEnd:!1,hasResult:!1});break}case w.TOOL_CALL_END:{const t=e.toolCallId,r=t?l.get(t):void 0;r&&(r.hasEnd=!0);break}case w.TOOL_CALL_RESULT:{const t=e.toolCallId,r=t?l.get(t):void 0;r&&(r.hasResult=!0);break}}const T=t.some(t=>t.type===w.RUN_FINISHED),d=t.some(t=>t.type===w.RUN_ERROR),E=!(T||d);for(const e of a){const r={type:w.TEXT_MESSAGE_END,messageId:e};t.push(r),s.push(r)}for(const[e,n]of l){if(!n.hasEnd){const r={type:w.TOOL_CALL_END,toolCallId:e};t.push(r),s.push(r)}if(E&&!n.hasResult){const n={type:w.TOOL_CALL_RESULT,toolCallId:e,messageId:`${null!=e?e:N()}-result`,role:"tool",content:JSON.stringify(r?{status:"stopped",reason:"stop_requested",message:o}:{status:"error",reason:"missing_terminal_event",message:i})};t.push(n),s.push(n)}}if(E)if(r){const e={type:w.RUN_FINISHED};t.push(e),s.push(e)}else{const e={type:w.RUN_ERROR,message:i,code:"INCOMPLETE_STREAM"};t.push(e),s.push(e)}return s},t.logger=_,t.partialJSONParse=function(t){try{return p.parse(t)}catch(t){return{}}},t.randomUUID=N});
//# sourceMappingURL=index.umd.js.map
