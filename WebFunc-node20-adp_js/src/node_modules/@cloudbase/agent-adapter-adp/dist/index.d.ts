import { AbstractAgent, AgentConfig, RunAgentInput, EventType } from '@ag-ui/client';
import { Observable } from 'rxjs';
import { lke } from 'tencentcloud-sdk-nodejs-lke';

/**
 * 文件信息
 */
interface FileInfo {
    /** 文件名称 */
    fileName: string;
    /** 文件大小（实时文档解析接口返回） */
    fileSize: string;
    /** 文件 URL（实时文档解析接口返回） */
    fileUrl: string;
    /** 文件类型 */
    fileType: string;
    /** 文档 ID（实时文档解析接口返回） */
    docId: string;
    /** 扩展参数 */
    [key: string]: any;
}
/**
 * ADP 对话请求参数
 */
interface AdpChatRequest {
    /** 请求 ID，用于标识一个请求 */
    requestId?: string;
    /** 消息内容 */
    content: string;
    /** 文件信息 */
    fileInfos?: FileInfo[];
    /** 会话 ID，用于标识一个会话 */
    sessionId: string;
    /** 应用密钥 */
    botAppKey: string;
    /** 访客 ID，标识当前接入会话的用户 */
    visitorBizId: string;
    /** 流式回复频率控制，控制应用回包频率 */
    streamingThrottle?: number;
    /** 自定义参数，用于传递参数给工作流或设置知识库检索范围 */
    customVariables?: Record<string, string>;
    /** 角色指令（提示词） */
    systemRole?: string;
    /** 控制回复事件和思考事件中的 content 是否是增量输出 */
    incremental?: boolean;
    /** 是否开启联网搜索：空字符串-跟随配置 / enable / disable */
    searchNetwork?: "" | "enable" | "disable";
    /** 指定模型名称 */
    modelName?: string;
    /** 是否开启流式传输：空字符串-跟随配置 / enable / disable */
    stream?: "" | "enable" | "disable";
    /** 是否开启工作流：空字符串-跟随配置 / enable / disable */
    workflowStatus?: "" | "enable" | "disable";
    /** 扩展参数 */
    [key: string]: any;
}
type AdpConfig = {
    request?: {
        baseUrl?: string;
        endpoint?: string;
        body?: Partial<AdpChatRequest>;
        docParseEndpoint?: string;
    };
    historyCount?: number;
    enableUpload?: boolean;
    appKey?: string;
    credential?: {
        secretId?: string;
        secretKey?: string;
        token?: string;
    };
};
type AdpChunk = {
    type: "reply";
    payload: ReplyEvent;
    message_id: string;
} | {
    type: "thought";
    payload: ThoughtEvent;
    message_id: string;
} | {
    type: "token_stat";
    payload: TokenStatEvent;
    message_id: string;
} | {
    type: "reference";
    payload: ReferenceEvent;
    message_id: string;
} | {
    type: "error";
    error: ErrorInfo;
};
interface ReplyEvent {
    request_id: string;
    content: string;
    file_infos: FileInfo[];
    record_id: string;
    related_record_id: string;
    session_id: string;
    is_from_self: boolean;
    can_rating: boolean;
    timestamp: number;
    is_final: boolean;
    is_evil: boolean;
    is_llm_generated: boolean;
    reply_method: ReplyMethod;
    knowledge?: Knowledge[];
    option_cards?: string[];
    custom_params?: string[];
    task_flow?: TaskFlow;
    work_flow?: WorkFlow;
    quote_infos?: QuoteInfo[];
}
declare enum ReplyMethod {
    LLM_REPLY = 1,
    UNKNOWN_QUESTION_REPLY = 2,
    REJECT_QUESTION_REPLY = 3,
    SENSITIVE_REPLY = 4,
    ADOPTED_QA_PRIORITY_REPLY = 5,
    WELCOME_REPLY = 6,
    CONCURRENCY_LIMIT_REPLY = 7,
    GLOBAL_INTERVENTION_KNOWLEDGE = 8,
    TASK_FLOW_REPLY = 9,
    TASK_FLOW_ANSWER = 10,
    SEARCH_ENGINE_REPLY = 11,
    KNOWLEDGE_POLISHED_REPLY = 12,
    IMAGE_UNDERSTANDING_REPLY = 13,
    REALTIME_DOCUMENT_REPLY = 14,
    CLARIFICATION_CONFIRMATION_REPLY = 15,
    WORKFLOW_REPLY = 16,
    WORKFLOW_EXECUTION_END = 17,
    AGENT_REPLY = 18,
    MULTI_INTENT_REPLY = 19
}
interface Knowledge {
    id: string;
    type: number;
    seg_id?: string;
}
interface TaskFlow {
    task_flow_name: string;
    task_flow_id: string;
    query_rewrite: string;
    hit_intent: string;
    slot_info: Record<string, any>;
    api_response: Record<string, any>;
    type: number;
}
interface WorkFlow {
    workflow_name: string;
    workflow_id: string;
    workflow_run_id: string;
    option_cards: string[];
    current_node: CurrentNode;
    outputs: Array<string>;
}
declare enum CurrentNodeStatus {
    Pending = 0,
    Running = 1,
    Succeeded = 2,
    Failed = 3
}
interface CurrentNode {
    NodeID: string;
    NodeType: number;
    NodeName: string;
    Status: CurrentNodeStatus;
    Input: string;
    Output: string;
    TaskOutput: string;
    FailMessage: string;
    CostMilliSeconds: string;
    Reply: string;
    BelongNodeID: string;
    StatisticInfo: StatisticInfo;
}
interface StatisticInfo {
    ModelName: string;
    FirstTokenCost: number;
    TotalCost: number;
    InputTokens: number;
    OutputTokens: number;
    TotalTokens: number;
}
interface QuoteInfo {
    index: number;
    position: number;
}
interface TokenStatEvent {
    session_id: string;
    request_id: string;
    record_id: string;
    status_summary: "processing" | "success" | "failed";
    status_summary_title: string;
    elapsed: number;
    token_count: number;
    procedures: TokenStatProcedure[];
}
interface TokenStatProcedure {
    name: string;
    title: string;
    status: "processing" | "success" | "failed";
    input_count: number;
    output_count: number;
    count: number;
}
interface ReferenceEvent {
    record_id: string;
    references: Reference[];
}
interface Reference {
    id: string | number;
    type: number;
    url?: string;
    name: string;
    doc_id: number;
    doc_biz_id: number;
    doc_name: string;
    qa_biz_id: string;
}
interface ErrorInfo {
    code: number;
    message: string;
}
interface ThoughtEvent {
    elapsed: number;
    is_workflow: boolean;
    procedures: ThoughtProcedure[];
    record_id: string;
    request_id: string;
    session_id: string;
    trace_id: string;
    workflow_name: string;
}
interface ThoughtProcedure {
    debugging: Debugging;
    index: number;
    name: string;
    title: string;
    status: "processing" | "success" | "failed";
    icon: string;
    switch: string;
    workflow_name: string;
    plugin_type: number;
    elapsed: number;
}
interface Debugging {
    content: string;
}
interface DocumentParseRequest {
    sessionId: string;
    botAppKey: string;
    requestId: string;
    cosBucket: string;
    fileType: string;
    fileName: string;
    cosUrl: string;
    cosHash: string;
    eTag: string;
    size: string;
}
interface DocumentParseChunk {
    type: "parsing";
    payload: ParsingEvent;
}
interface ParsingEvent {
    session_id: string;
    trace_id: string;
    is_final: boolean;
    doc_id: string;
    process: number;
    status: string;
    timestamp: number;
    error_message: string;
}

declare class AdpAgentError extends Error {
    code?: string;
    constructor(message: string, code?: string);
}
type CosParams = Awaited<ReturnType<typeof lke.v20231130.Client.prototype.DescribeStorageCredential>>;
declare class AdpAgent extends AbstractAgent {
    private reqAppClient;
    private reqLkeClient;
    protected adpConfig: AdpConfig;
    private finalAppKey;
    private finalCloudCredential;
    constructor(config: AgentConfig & {
        adpConfig: AdpConfig;
    });
    generateRequestBody({ message, fileInfos, input, }: {
        message: string;
        fileInfos: FileInfo[];
        input: RunAgentInput;
    }): AdpChatRequest;
    run(input: RunAgentInput): Observable<{
        type: EventType;
        timestamp?: number | undefined;
        rawEvent?: any;
    }>;
    private _run;
    private convertAGUIMessagesToAdpMessages;
    private extractDocuments;
    private getCosParams;
    private uploadToCos;
}

export { AdpAgent, AdpAgentError, type AdpChatRequest, type AdpChunk, type AdpConfig, type CosParams, type CurrentNode, CurrentNodeStatus, type Debugging, type DocumentParseChunk, type DocumentParseRequest, type ErrorInfo, type FileInfo, type Knowledge, type ParsingEvent, type QuoteInfo, type Reference, type ReferenceEvent, type ReplyEvent, ReplyMethod, type StatisticInfo, type TaskFlow, type ThoughtEvent, type ThoughtProcedure, type TokenStatEvent, type TokenStatProcedure, type WorkFlow };
