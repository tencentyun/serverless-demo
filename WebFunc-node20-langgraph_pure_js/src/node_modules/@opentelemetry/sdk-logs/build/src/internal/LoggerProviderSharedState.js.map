{"version":3,"file":"LoggerProviderSharedState.js","sourceRoot":"","sources":["../../../src/internal/LoggerProviderSharedState.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAGH,sDAAyD;AAKzD,6EAA0E;AAC1E,wEAAqE;AACrE,mCAAqD;AAErD,MAAM,qBAAqB,GAA2B;IACpD,QAAQ,EAAE,KAAK;IACf,eAAe,EAAE,yBAAc,CAAC,WAAW;IAC3C,UAAU,EAAE,KAAK;CAClB,CAAC;AAEF;;GAEG;AACH,MAAM,2BAA2B,GAAuB,GAAG,EAAE,CAAC,CAAC;IAC7D,GAAG,qBAAqB;CACzB,CAAC,CAAC;AAEH,MAAa,yBAAyB;IAC3B,OAAO,GAAwB,IAAI,GAAG,EAAE,CAAC;IAClD,eAAe,CAAqB;IAC3B,6BAA6B,GAAyB,EAAE,CAAC;IACzD,QAAQ,CAAW;IACnB,uBAAuB,CAAS;IAChC,eAAe,CAA4B;IAC3C,UAAU,CAAuB;IAClC,mBAAmB,CAAqB;IACxC,cAAc,GAAwC,IAAI,GAAG,EAAE,CAAC;IAExE,YACE,QAAkB,EAClB,uBAA+B,EAC/B,eAA0C,EAC1C,UAAgC,EAChC,kBAAuC;QAEvC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,uBAAuB,GAAG,uBAAuB,CAAC;QACvD,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACzB,IAAI,CAAC,6BAA6B,GAAG,UAAU,CAAC;YAChD,IAAI,CAAC,eAAe,GAAG,IAAI,iDAAuB,CAChD,IAAI,CAAC,6BAA6B,EAClC,IAAI,CAAC,uBAAuB,CAC7B,CAAC;SACH;aAAM;YACL,IAAI,CAAC,eAAe,GAAG,IAAI,+CAAsB,EAAE,CAAC;SACrD;QAED,IAAI,CAAC,mBAAmB;YACtB,kBAAkB,IAAI,2BAA2B,CAAC;IACtD,CAAC;IAED;;;;;;OAMG;IACH,eAAe,CACb,oBAA0C;QAE1C,MAAM,GAAG,GAAG,IAAA,kCAA0B,EAAC,oBAAoB,CAAC,CAAC;QAE7D,oCAAoC;QACpC,IAAI,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC1C,IAAI,MAAM,EAAE;YACV,OAAO,MAAM,CAAC;SACf;QAED,wCAAwC;QACxC,oDAAoD;QACpD,MAAM,GAAG,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,CAAC;QAExD,mBAAmB;QACnB,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QAErC,OAAO,MAAM,CAAC;IAChB,CAAC;CACF;AA/DD,8DA+DC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Logger } from '@opentelemetry/api-logs';\nimport { SeverityNumber } from '@opentelemetry/api-logs';\nimport { Resource } from '@opentelemetry/resources';\nimport type { InstrumentationScope } from '@opentelemetry/core';\nimport { LogRecordProcessor } from '../LogRecordProcessor';\nimport { LogRecordLimits, LoggerConfig, LoggerConfigurator } from '../types';\nimport { NoopLogRecordProcessor } from '../export/NoopLogRecordProcessor';\nimport { MultiLogRecordProcessor } from '../MultiLogRecordProcessor';\nimport { getInstrumentationScopeKey } from './utils';\n\nconst DEFAULT_LOGGER_CONFIG: Required<LoggerConfig> = {\n  disabled: false,\n  minimumSeverity: SeverityNumber.UNSPECIFIED,\n  traceBased: false,\n};\n\n/**\n * Default LoggerConfigurator that returns the default config for all loggers\n */\nconst DEFAULT_LOGGER_CONFIGURATOR: LoggerConfigurator = () => ({\n  ...DEFAULT_LOGGER_CONFIG,\n});\n\nexport class LoggerProviderSharedState {\n  readonly loggers: Map<string, Logger> = new Map();\n  activeProcessor: LogRecordProcessor;\n  readonly registeredLogRecordProcessors: LogRecordProcessor[] = [];\n  readonly resource: Resource;\n  readonly forceFlushTimeoutMillis: number;\n  readonly logRecordLimits: Required<LogRecordLimits>;\n  readonly processors: LogRecordProcessor[];\n  private _loggerConfigurator: LoggerConfigurator;\n  private _loggerConfigs: Map<string, Required<LoggerConfig>> = new Map();\n\n  constructor(\n    resource: Resource,\n    forceFlushTimeoutMillis: number,\n    logRecordLimits: Required<LogRecordLimits>,\n    processors: LogRecordProcessor[],\n    loggerConfigurator?: LoggerConfigurator\n  ) {\n    this.resource = resource;\n    this.forceFlushTimeoutMillis = forceFlushTimeoutMillis;\n    this.logRecordLimits = logRecordLimits;\n    this.processors = processors;\n    if (processors.length > 0) {\n      this.registeredLogRecordProcessors = processors;\n      this.activeProcessor = new MultiLogRecordProcessor(\n        this.registeredLogRecordProcessors,\n        this.forceFlushTimeoutMillis\n      );\n    } else {\n      this.activeProcessor = new NoopLogRecordProcessor();\n    }\n\n    this._loggerConfigurator =\n      loggerConfigurator ?? DEFAULT_LOGGER_CONFIGURATOR;\n  }\n\n  /**\n   * Get the LoggerConfig for a given instrumentation scope.\n   * Uses the LoggerConfigurator function to compute the config on first access\n   * and caches the result.\n   *\n   * @experimental This feature is in development as per the OpenTelemetry specification.\n   */\n  getLoggerConfig(\n    instrumentationScope: InstrumentationScope\n  ): Required<LoggerConfig> {\n    const key = getInstrumentationScopeKey(instrumentationScope);\n\n    // Return cached config if available\n    let config = this._loggerConfigs.get(key);\n    if (config) {\n      return config;\n    }\n\n    // Compute config using the configurator\n    // The configurator always returns a complete config\n    config = this._loggerConfigurator(instrumentationScope);\n\n    // Cache the result\n    this._loggerConfigs.set(key, config);\n\n    return config;\n  }\n}\n"]}